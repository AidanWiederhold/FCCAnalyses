<!-- HTML header for doxygen 1.8.15-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>FCCAnalyses: FCCAnalyses</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="fccanalyses_stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">FCCAnalyses
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">FCCAnalyses </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_README"></a></p>
<p>This package produce flat ROOT trees using FCCSW EDM root files produced with the <a href="https://github.com/HEP-FCC/EventProducer">EventProducer</a>. As usual, if you aim at contributing to the repository, please fork it, develop and submit pull requests. To have access to the FCC samples, you need to subscribe to one of the following e-group (with owner approval) <code>fcc-eos-read-xx</code> with <code>xx=ee,hh,eh</code>. For the time being, the configuration files are accessible on <code>helsens</code> public <code>afs</code>. This is not optimal and will be changed in the future, thus you are also kindly asked to contact <code>clement.helsens@cern.ch</code> and request access to <code>/afs/cern.ch/work/h/helsens/public/FCCDicts/</code>.</p>
<p>Analysers documentation <a href="http://hep-fcc.github.io/FCCAnalyses/doc/latest/index.html">here</a></p>
<h1><a class="anchor" id="autotoc_md0"></a>
Table of contents</h1>
<ul>
<li><a href="#fccanalyses">FCCAnalyses</a></li>
<li><a href="#table-of-contents">Table of contents</a></li>
<li><a href="#rootdataframe-based">RootDataFrame based</a><ul>
<li><a href="#getting-started">Getting Started</a></li>
<li><a href="#generalities">Generalities</a></li>
<li><a href="#pre-selection">Pre selection</a></li>
<li><a href="#final-selection">Final selection</a></li>
<li><a href="#plotting">Plotting</a></li>
</ul>
</li>
<li><a href="#uproot-based">Uproot based</a><ul>
<li><a href="#getting-started">Getting Started</a></li>
<li>[Running]</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="autotoc_md1"></a>
RootDataFrame based</h1>
<p>Using ROOT dataframe allows a much quicker processing time. In this implementation, everything from reading EDM4Hep or FCCSW EDM files on eos and producing flat n-tuples, to running a final selection and plotting the results will be explained.</p>
<h1><a class="anchor" id="autotoc_md2"></a>
Getting Started</h1>
<p>In order to use ROOT dataframe for the analyses, the dictionary with the analyzers needs to be built and put into <code>LD_LIBRARY_PATH</code> (this happens in <code>setup.sh</code>)</p>
<p>First check if FCCSW is setup. If the command <code>which fccrun</code> returns something like: <code>/cvmfs/sw.hsf.org/spackages/linux-centos7-broadwell/gcc-8.3.0/fccsw-develop-q57ahua7lm65fvxnzekozih4mgvzptlx/scripts/fccrun</code> then you are good to go, if not please run:</p>
<div class="fragment"><div class="line">source /cvmfs/fcc.cern.ch/sw/latest/setup.sh</div>
</div><!-- fragment --><div class="fragment"><div class="line">source ./setup.sh</div>
<div class="line">mkdir build install</div>
<div class="line">cd build</div>
<div class="line">cmake .. -DCMAKE_INSTALL_PREFIX=../install</div>
<div class="line">make install</div>
</div><!-- fragment --><p>Each time changes are made in <code>analyzers/dataframe/</code> please re-compile!</p>
<h1><a class="anchor" id="autotoc_md3"></a>
Generalities</h1>
<p>Each analysis is hosted in a single directory, for example <code>examples/FCCee/higgs/mH-recoil/mumu/</code> and contains the same kind of files, please use the same naming convention for all analysis.</p>
<ol type="1">
<li><code>analysis.py</code>: This class that is used to define the list of analysers and filters to run on as well as the output variables.</li>
<li><code>preSel.py</code>: This configuration file is used to define how to run the <code>analysis.py</code>. It contains the list of samples, the number of CPUs, the fraction of the original sample to process and the base directory for the yaml files (that contains the informations about the samples). This will run the <code>analysis.py</code> with a common code <code>config/runDataFrame.py</code> (this last file is common to all analyses and should not be touched).</li>
<li><code>finalSel.py</code>: This configuration file contains the final selections and it runs over the locally produced flat ntuples from the <code>preSel.py</code>. It contains a link to the <code>procDict.json</code> for getting cross section etc...(this might be removed later to include everything in the yaml, closer to the sample), the list of processes, the number of CPU, the cut list, and the variables (that will be both written in a <code>TTree</code> and in the form of <code>TH1</code> properly normalised to an integrated luminosity of 1pb-1.</li>
<li><code>plots.py</code>: This configuration files is used to select the final selections from running <code>finalSel.py</code> to plot. Informations about how to merge processes, write some extra text, normalise to a given integrated luminosity etc... For the moment it is possible to only plot one signal at the time, but several backgrounds.</li>
</ol>
<h1><a class="anchor" id="autotoc_md4"></a>
Pre-selection</h1>
<p>The pre-selection runs over already existing and properly registered FCCSW EDM events. The dataset names with the corresponding statistics can be found <a href="http://fcc-physics-events.web.cern.ch/fcc-physics-events/Delphesevents_fccee_v01.php">here</a>. One important parameter is the fraction of the total dataset to run. It can be found in the <code>preSel.py</code> file by setting a value between ]0,1]. For example <code>fraction=0.1</code> will run over 10% of the statistics. Reading the files on <code>eos</code>, and with 15 CPUs we observe processing speeds between 3000 and 10000 events per seconds depending on the number of files. Only run full statistics after having done all the proper testing and analysis design as it can take some time (that of course depends on the sample total statistics). To run the pre-selection of the <code>ZH_Zmumu</code> analysis, just run: </p><div class="fragment"><div class="line">python examples/FCCee/higgs/mH-recoil/mumu/preSel.py</div>
</div><!-- fragment --><p>This will output 3 files in <code>outputs/FCCee/higgs/mH-recoil/mumu/</code> following the parameter <code>outdir</code> in the <code>preSel.py</code> configuration file.</p>
<h1><a class="anchor" id="autotoc_md5"></a>
Final selection</h1>
<p>The final selection runs on the pre-selection files that we produced in the <a href="#pre-selection">Pre-selection</a> step. In the configuration file <code>finalSel.py</code> we define the various cuts to run on and the final variables to be stored in both a <code>TTree</code> and histograms. This is why the variables needs extra fields like <code>title</code>, number of bins and range for the histogram creation. In this example it should run like:</p>
<div class="fragment"><div class="line">python examples/FCCee/higgs/mH-recoil/mumu/finalSel.py</div>
</div><!-- fragment --><p>This will create 2 files per selection <code>SAMPLENAME_SELECTIONNAME.root</code> for the <code>TTree</code> and <code>SAMPLENAME_SELECTIONNAME_histo.root</code> for the histograms. <code>SAMPLENAME</code> and <code>SELECTIONNAME</code> corresponds to the name of the sample and selection respectively in the configuration file.</p>
<h1><a class="anchor" id="autotoc_md6"></a>
Plotting</h1>
<p>The plotting configuration file <code>plots.py</code> contains informations about plotting details for plots rendering but also ways of combining samples for plotting. In this example just run like: </p><div class="fragment"><div class="line">doPlots.py examples/FCCee/higgs/mH-recoil/mumu/plots.py</div>
</div><!-- fragment --><p>This will produce the plots in the <code>outdir</code> defined in the configuration file.</p>
<h1><a class="anchor" id="autotoc_md7"></a>
Uproot based</h1>
<p>For the time being the uproot analyses is using the output of the RootDataFrame (small ntuples)</p>
<h1><a class="anchor" id="autotoc_md8"></a>
Getting Started</h1>
<p>This step requires extra packages that we will install locally. For that please specify the place where you want those to be instal by setting this enviroment variable (please adapt MYPATH to where you want the packages to be installed): </p><div class="fragment"><div class="line">export PYTHONUSERBASE=/MYPATH/.local</div>
</div><!-- fragment --><p>First we need to upgrade pip: </p><div class="fragment"><div class="line">curl https://bootstrap.pypa.io/get-pip.py -o get-pip.py</div>
<div class="line">python get-pip.py</div>
</div><!-- fragment --><p>and add it to the path so that we run the new installed version </p><div class="fragment"><div class="line">export PATH=/MYPATH/.local/bin:$PATH</div>
</div><!-- fragment --><p>Then install the following packages:</p>
<div class="fragment"><div class="line">#python -m pip install --user zfit --use-feature=2020-resolver</div>
<div class="line">python -m pip install --user uproot4 --use-feature=2020-resolver</div>
<div class="line">python -m pip install --user awkward1 --use-feature=2020-resolver</div>
<div class="line">#python -m pip install --user matplotlib --use-feature=2020-resolver</div>
<div class="line">python -m pip install --user particle --use-feature=2020-resolver</div>
</div><!-- fragment --><div class="fragment"><div class="line">export PYTHONPATH=/MYPATH/.local/lib/python3.7/site-packages:$PYTHONPATH</div>
</div><!-- fragment --> </div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- HTML footer for doxygen 1.8.15-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Dec 10 2020 12:27:57 for FCCAnalyses by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.20
</small></address>
</body>
</html>
